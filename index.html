<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let basket = { x: canvas.width/2 - 30, y: canvas.height - 30, width: 60, height: 20 };
let items = [];
let score = 0;
let timeLeft = 300; // 5 minutes = 300 seconds
let gameOver = false;

const timerDisplay = document.getElementById("timer");
const scoreDisplay = document.getElementById("score");

// Countdown once per second
let countdownInterval = setInterval(() => {
  timeLeft--;
  let minutes = Math.floor(timeLeft / 60);
  let seconds = timeLeft % 60;
  timerDisplay.textContent = `Time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
  if (timeLeft <= 0) {
    gameOver = true;
    clearInterval(countdownInterval);
  }
}, 1000); // 1000 ms = 1 second

document.addEventListener("keydown", (e) => {
  if (e.key === "ArrowLeft") basket.x -= 20;
  if (e.key === "ArrowRight") basket.x += 20;
  basket.x = Math.max(0, Math.min(canvas.width - basket.width, basket.x));
});

function spawnItem() {
  let size = 20;
  items.push({
    x: Math.random() * (canvas.width - size),
    y: -size,
    size: size,
    speed: 2 + Math.random() * 2
  });
}

function update() {
  if (gameOver) return;

  // Move items
  items.forEach(item => {
    item.y += item.speed;
  });

  // Check for catch
  for (let i = items.length - 1; i >= 0; i--) {
    let item = items[i];
    if (
      item.y + item.size >= basket.y &&
      item.x + item.size >= basket.x &&
      item.x <= basket.x + basket.width
    ) {
      score++;
      scoreDisplay.textContent = "Score: " + score;
      items.splice(i, 1);
    } else if (item.y > canvas.height) {
      items.splice(i, 1);
    }
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw basket
  ctx.fillStyle = "brown";
  ctx.fillRect(basket.x, basket.y, basket.width, basket.height);

  // Draw items
  ctx.fillStyle = "red";
  items.forEach(item => {
    ctx.beginPath();
    ctx.arc(item.x + item.size/2, item.y + item.size/2, item.size/2, 0, Math.PI * 2);
    ctx.fill();
  });

  if (gameOver) {
    ctx.fillStyle = "black";
    ctx.font = "24px sans-serif";
    ctx.fillText("Game Over! Final Score: " + score, 30, canvas.height/2);
  }
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

// Spawn new items periodically
setInterval(spawnItem, 800);

gameLoop();
</script>
